name: Daily Job Update

on:
  schedule:
    - cron: '0 6 * * *' # Jeden Morgen um 06:00 Uhr
  workflow_dispatch:      # Manueller Start

permissions:
  contents: write

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Code auschecken
        uses: actions/checkout@v3

      - name: Python einrichten
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'

      - name: Bibliotheken installieren
        run: |
          pip install requests

      - name: Job-Board bauen üèóÔ∏è
        env:
          GROQ_API: ${{ secrets.GROQ_API }}
        run: |
          python build_jobs.py

      # REPARIERTER SCHRITT: Cache speichern
      - name: Cache speichern (in main)
        run: |
          git config --global user.name "Job-Bot ü§ñ"
          git config --global user.email "bot@example.com"
          
          # Wir f√ºgen explizit nur den Cache hinzu
          git add ai_cache.json
          
          # Der Trick: Wir pr√ºfen, ob NUR DIESE DATEI im "Staging" Bereich liegt
          # Wenn ja (diff-index --quiet gibt Fehler zur√ºck), dann committen.
          # Wenn nein (keine √Ñnderungen im Cache), passiert nichts.
          git diff-index --quiet HEAD ai_cache.json || (git commit -m "üß† Cache Update" && git push)

      # Webseite ver√∂ffentlichen
      - name: Auf GitHub Pages deployen üöÄ
        uses: JamesIves/github-pages-deploy-action@v4
        with:
          folder: job_board
          branch: gh-pages
