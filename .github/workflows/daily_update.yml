name: Daily Job Update

on:
  schedule:
    - cron: '0 6 * * *' # Jeden Morgen um 06:00 Uhr
  workflow_dispatch:      # Manueller Start

permissions:
  contents: write

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Code auschecken
        uses: actions/checkout@v3

      - name: Python einrichten
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'

      - name: Bibliotheken installieren
        run: |
          pip install requests

      - name: Job-Board bauen ğŸ—ï¸
        env:
          GROQ_API: ${{ secrets.GROQ_API }}
        run: |
          python build_jobs.py

      # SCHRITT A: Das Gehirn (Cache) sichern!
      # Wir speichern ai_cache.json zurÃ¼ck in den "main" Branch
      - name: Cache speichern (in main)
        run: |
          git config --global user.name "Job-Bot ğŸ¤–"
          git config --global user.email "bot@example.com"
          git add ai_cache.json
          # Nur committen, wenn sich der Cache geÃ¤ndert hat
          git diff --quiet && git diff --staged --quiet || (git commit -m "ğŸ§  Cache Update" && git push)

      # SCHRITT B: Die Webseite verÃ¶ffentlichen!
      # Wir schieben NUR den Ordner "job_board" auf den Branch "gh-pages"
      - name: Auf GitHub Pages deployen ğŸš€
        uses: JamesIves/github-pages-deploy-action@v4
        with:
          folder: job_board # Dieser Ordner wird zur Webseite
          branch: gh-pages  # Der Zweig fÃ¼r die Live-Seite
